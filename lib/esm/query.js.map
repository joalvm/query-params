{"version":3,"file":"query.js","sources":["../../../src/query.ts"],"sourcesContent":["/**\r\n * Utilitario para manejar los parametros como objeto y luego convertirlos a string\r\n * y unirlos a una url.\r\n */\r\nexport default class Query {\r\n    /**\r\n     * @property {boolean}\r\n     */\r\n    private encode: boolean = false;\r\n\r\n    /**\r\n     *\r\n     * @param {Object} parameters Parametros a ser serializados.\r\n     * @param {string|undefined} url (Opcional) url que se unir√° a los parametros.\r\n     */\r\n    constructor(\r\n        private parameters: Record<string, any>,\r\n        private url: string = \"\"\r\n    ) {}\r\n\r\n    /**\r\n     * Serializa los parametros y lo concatena a la url.\r\n     *\r\n     * @param {boolean} encode Condificar los caracteres especiales.\r\n     * @returns {string}\r\n     */\r\n    serialize(encode: boolean = false): string {\r\n        this.encode = encode;\r\n\r\n        return this.concat(\r\n            Object.entries(this.flatten(this.parameters))\r\n                .map(this.handleEncode.bind(this))\r\n                .join(\"&\")\r\n        );\r\n    }\r\n\r\n    private concat(params: string) {\r\n        if (!this.url) {\r\n            return params;\r\n        }\r\n\r\n        return this.url.replace(/\\/$/, \"\") + \"?\" + params;\r\n    }\r\n\r\n    private handleEncode(pair: [string, string]): string {\r\n        return (this.encode ? pair.map(encodeURIComponent) : pair).join(\"=\");\r\n    }\r\n\r\n    private flatten(\r\n        obj: Record<string, any>,\r\n        path?: string,\r\n        result?: Record<string, any>\r\n    ): Record<string, string> {\r\n        // Si es la primerera llamada osea cuando no es un llamado de la recursividad\r\n        if (result === undefined) {\r\n            var type = Object.prototype.toString.call(obj);\r\n\r\n            if (type === \"[object Object]\") {\r\n                result = {};\r\n            } else if (type === \"[object Array]\") {\r\n                result = [];\r\n            } else {\r\n                return {};\r\n            }\r\n        }\r\n\r\n        for (var key in obj) {\r\n            if (!obj.hasOwnProperty(key)) {\r\n                continue;\r\n            }\r\n\r\n            if (!obj[key]) {\r\n                continue;\r\n            }\r\n\r\n            switch (Object.prototype.toString.call(obj[key])) {\r\n                case \"[object Array]\":\r\n                case \"[object Object]\":\r\n                    this.flatten(obj[key], this.join(key, path), result);\r\n                    break;\r\n                default:\r\n                    result[this.join(key, path)] = !this.encode\r\n                        ? encodeURIComponent(obj[key])\r\n                        : obj[key];\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private join(key: string, path?: string): string {\r\n        if (path) {\r\n            return `${path}[${key}]`;\r\n        }\r\n\r\n        return key;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}